{% extends 'base.html' %}

{% block lab %}РГЗ — Кинотеатр{% endblock %}

{% block script %}
    <link rel="stylesheet" href="/static/rgz/rgz.css">
    <script src="/static/rgz/rgz.js"></script>
{% endblock %}

{% block main %}

    {% if login %}

    <!-- < Авторизованный пользователь > -->

    <div class="rgz-card">

        <!-- < Панель пользователя > -->
        <header class="rgz-local-header">
            <h1>Кинотеатр — бронирование мест</h1>
        </header>

        <div class="rgz-topbar">
            <div>
                {% if is_admin %}
                    Вы вошли как: <b>{{ name }}</b> ({{ login }}) <span class="rgz-admin-badge">ADMIN</span>
                {% else %}
                    Вы вошли как: <b>{{ name }}</b> ({{ login }})
                {% endif %}
            </div>

            <div class="rgz-actions">
                <button class="rgz-btn" onclick="logout()">Выйти</button>
                <button class="rgz-btn rgz-btn-danger" onclick="deleteMe()">Удалить аккаунт</button>
            </div>
        </div>

        <!-- < Сеансы > -->
        <div class="rgz-card-head">
            <h2>Сеансы</h2>
        </div>

        {% if is_admin %}
        <!-- < Админ: добавление сеанса > -->
        <div style="margin-bottom:10px; display:grid; grid-template-columns: 1fr 1fr auto; gap:12px;">
            <input id="new-film" type="text" placeholder="Фильм" class="rgz-input">
            <input id="new-start" type="text" placeholder="YYYY-MM-DD HH:MM"
                oninput="rgz_format_datetime_input(this)" class="rgz-input">
            <button class="rgz-btn" onclick="createScreening()">Добавить</button>
        </div>

        <div id="msg-admin" class="rgz-msg" style="margin-bottom:10px;"></div>
        {% endif %}

        <!-- < Таблица сеансов > -->
        <table class="rgz-table">
            <thead>
                <tr>
                    <th>Фильм</th>
                    <th>Дата/время</th>
                    <th>Статус</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody id="screening-list"></tbody>
        </table>

    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            loadScreenings();
        });
    </script>

    {% else %}

    <!-- < Авторизация > -->

    <div class="rgz-card" style="margin-top:40px;">
        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 30px; align-items: stretch;">

            <!-- < Вход > -->
            <div class="rgz-auth-column">

                <div class="rgz-auth-top">
                    <h2 style="text-align:center;"> Вход </h2>

                    <div class="rgz-field">
                        <label>Логин</label>
                        <input class="rgz-input" id="log-login" type="text">
                    </div>

                    <div class="rgz-field">
                        <label>Пароль</label>
                        <input class="rgz-input" id="log-pass" type="password">
                    </div>

                    <div style="font-size:14px; color:#753f3f;">Для проверки работы:</div>

                    <div class="rgz-auth-demo">
                        <b>Админ:</b> логин <code>admin</code>, пароль <code>Admin!123</code>
                    </div>
                </div>

                <div class="rgz-auth-bottom">
                    <button class="rgz-btn" onclick="login()">Войти</button>
                    <div id="msg-login" class="rgz-msg"></div>
                </div>

            </div>

            <div class="rgz-auth-or">или</div>

            <!-- < Регистрация > -->
            <div class="rgz-auth-column">

                <div class="rgz-auth-top">
                    <h2 style="text-align:center;"> Регистрация </h2>

                    <div class="rgz-field">
                        <label>Имя</label>
                        <input class="rgz-input" id="reg-name" type="text">
                    </div>

                    <div class="rgz-field">
                        <label>Логин</label>
                        <input class="rgz-input" id="reg-login" type="text">
                    </div>

                    <div class="rgz-field">
                        <label>Пароль</label>
                        <input class="rgz-input" id="reg-pass" type="password">
                    </div>
                </div>

                <div class="rgz-auth-bottom">
                    <button class="rgz-btn" onclick="register()">Зарегистрироваться</button>
                    <div id="msg-register" class="rgz-msg"></div>
                </div>

            </div>

        </div>
    </div>

    {% endif %}

{% endblock %}
